--
-- Script was generated by Devart dbForge Studio 2020 for MySQL, Version 9.0.338.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 2/23/2023 2:11:41 AM
-- Server version: 8.0.30
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

--
-- Set default database
--
USE capstoneproject;

--
-- Drop table `transactions`
--
DROP TABLE IF EXISTS transactions;

--
-- Drop table `cards`
--
DROP TABLE IF EXISTS cards;

--
-- Drop table `users`
--
DROP TABLE IF EXISTS users;

--
-- Drop table `rentals`
--
DROP TABLE IF EXISTS rentals;

--
-- Drop table `standardbikes`
--
DROP TABLE IF EXISTS standardbikes;

--
-- Drop table `standardebikes`
--
DROP TABLE IF EXISTS standardebikes;

--
-- Drop table `twinbikes`
--
DROP TABLE IF EXISTS twinbikes;

--
-- Drop table `bikes`
--
DROP TABLE IF EXISTS bikes;

--
-- Drop table `docks`
--
DROP TABLE IF EXISTS docks;

--
-- Set default database
--
USE capstoneproject;

--
-- Create table `docks`
--
CREATE TABLE docks (
  dockId VARCHAR(30) NOT NULL DEFAULT '',
  name VARCHAR(100) DEFAULT NULL,
  address VARCHAR(255) DEFAULT NULL,
  area INT DEFAULT NULL,
  number_of_available_bikes INT DEFAULT NULL,
  number_of_docking_points INT DEFAULT NULL,
  imageURL VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (dockId)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 5461,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create check constraint
--
ALTER TABLE docks 
  ADD CONSTRAINT CK_docks CHECK (`number_of_available_bikes` >= 0);

--
-- Create table `bikes`
--
CREATE TABLE bikes (
  bikeId VARCHAR(30) NOT NULL DEFAULT '',
  barCode VARCHAR(30) NOT NULL DEFAULT '',
  rentalCode VARCHAR(30) NOT NULL DEFAULT '',
  linsencePlate VARCHAR(30) NOT NULL DEFAULT '',
  dockId VARCHAR(30) NOT NULL DEFAULT '',
  status TINYINT NOT NULL,
  imageURL VARCHAR(255) DEFAULT NULL,
  type VARCHAR(30) DEFAULT NULL,
  price DOUBLE DEFAULT NULL,
  PRIMARY KEY (bikeId)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 1638,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create index `barCode` on table `bikes`
--
ALTER TABLE bikes 
  ADD UNIQUE INDEX barCode(barCode);

--
-- Create index `rentalCode` on table `bikes`
--
ALTER TABLE bikes 
  ADD UNIQUE INDEX rentalCode(rentalCode);

--
-- Create foreign key
--
ALTER TABLE bikes 
  ADD CONSTRAINT FK_bikes_dockId FOREIGN KEY (dockId)
    REFERENCES docks(dockId) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Create table `twinbikes`
--
CREATE TABLE twinbikes (
  twinbikeId VARCHAR(30) NOT NULL DEFAULT '',
  PRIMARY KEY (twinbikeId)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 5461,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create foreign key
--
ALTER TABLE twinbikes 
  ADD CONSTRAINT FK_twinbikes_twinbikeId FOREIGN KEY (twinbikeId)
    REFERENCES bikes(bikeId) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Create table `standardebikes`
--
CREATE TABLE standardebikes (
  standardebikeId VARCHAR(30) NOT NULL DEFAULT '',
  hourlyRate INT DEFAULT NULL,
  batteryPercentage INT DEFAULT NULL,
  PRIMARY KEY (standardebikeId)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 5461,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create foreign key
--
ALTER TABLE standardebikes 
  ADD CONSTRAINT FK_standardebikes_standardebikes FOREIGN KEY (standardebikeId)
    REFERENCES bikes(bikeId) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Create table `standardbikes`
--
CREATE TABLE standardbikes (
  standardbikeId VARCHAR(30) NOT NULL DEFAULT '',
  PRIMARY KEY (standardbikeId)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 4096,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create foreign key
--
ALTER TABLE standardbikes 
  ADD CONSTRAINT FK_standardbikes_standardbikeId FOREIGN KEY (standardbikeId)
    REFERENCES bikes(bikeId) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Create table `rentals`
--
CREATE TABLE rentals (
  rentalId VARCHAR(36) NOT NULL DEFAULT '',
  bikeId VARCHAR(30) DEFAULT NULL,
  startTime TIME DEFAULT NULL,
  endTime TIME DEFAULT NULL,
  totalCost DOUBLE DEFAULT NULL,
  PRIMARY KEY (rentalId)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 1820,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create foreign key
--
ALTER TABLE rentals 
  ADD CONSTRAINT FK_rentals_bikeId FOREIGN KEY (bikeId)
    REFERENCES bikes(bikeId) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Create table `users`
--
CREATE TABLE users (
  userId VARCHAR(30) NOT NULL DEFAULT '',
  fullName VARCHAR(100) DEFAULT NULL,
  phoneNumber VARCHAR(10) DEFAULT NULL,
  email VARCHAR(100) DEFAULT NULL,
  address VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (userId)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create table `cards`
--
CREATE TABLE cards (
  cardId VARCHAR(30) NOT NULL DEFAULT '',
  userId VARCHAR(30) DEFAULT NULL,
  cardNumber VARCHAR(30) DEFAULT NULL,
  cardHolderName VARCHAR(30) DEFAULT NULL,
  expirationDate DATE DEFAULT NULL,
  securityCode VARCHAR(30) DEFAULT NULL,
  PRIMARY KEY (cardId)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create foreign key
--
ALTER TABLE cards 
  ADD CONSTRAINT FK_cards_userId FOREIGN KEY (userId)
    REFERENCES users(userId) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Create table `transactions`
--
CREATE TABLE transactions (
  transactionId VARCHAR(30) NOT NULL DEFAULT '',
  rentalId VARCHAR(30) DEFAULT NULL,
  amount DECIMAL(19, 2) NOT NULL,
  method VARCHAR(45) DEFAULT NULL,
  createAt DATETIME DEFAULT NULL,
  transactionDescription VARCHAR(255) DEFAULT NULL,
  cardId VARCHAR(30) DEFAULT NULL,
  PRIMARY KEY (transactionId)
)
ENGINE = INNODB,
CHARACTER SET utf8mb4,
COLLATE utf8mb4_general_ci;

--
-- Create foreign key
--
ALTER TABLE transactions 
  ADD CONSTRAINT FK_transactions_cardId FOREIGN KEY (cardId)
    REFERENCES cards(cardId);

--
-- Create foreign key
--
ALTER TABLE transactions 
  ADD CONSTRAINT FK_transactions_rentalId FOREIGN KEY (rentalId)
    REFERENCES rentals(rentalId) ON DELETE CASCADE ON UPDATE CASCADE;

-- 
-- Dumping data for table docks
--
INSERT INTO docks VALUES
('dock1', 'BK-EBIKE', '36 P. Tạ Quang Bửu, Bách Khoa,Hà Nội', 123, 2, 34, 'assets/images/dock1.png'),
('dock2', 'Mini E-Scooter', '190 P. Sài Đồng,Long Biên, Hà Nội', 223, 3, 41, 'assets/images/dock2.png'),
('dock3', 'Huy Hiệu Motor', '133, Đống Đa, Hà Nội 100000', 342, 5, 22, 'assets/images/dock3.png');

-- 
-- Dumping data for table bikes
--
INSERT INTO bikes VALUES
('bike1', 'IT2233', 'ITSS3422', 'HN1234', 'dock1', 1, 'assets/images/bike1.png', 'Xe đạp thường', 400000),
('bike10', 'IT2209', 'ITSS3411', 'HN1222', 'dock1', 1, 'assets/images/bike10.png', 'Xe đạp thường', 400000),
('bike2', 'IT2234', 'ITSS3423', 'HP1234', 'dock3', 1, 'assets/images/bike2.png', 'Xe đạp đôi', 550000),
('bike3', 'IT2235', 'ITSS3424', 'HN3456', 'dock2', 1, 'assets/images/bike3.png', 'Xe đạp điện', 700000),
('bike4', 'IT2236', 'ITSS3425', 'QN8995', 'dock2', 1, 'assets/images/bike4.png', 'Xe đạp thường', 400000),
('bike5', 'IT2237', 'ITSS3426', 'HT1576', 'dock3', 1, 'assets/images/bike5.png', 'Xe đạp đôi', 550000),
('bike6', 'IT2238', 'ITSS3427', 'HN1233', 'dock3', 1, 'assets/images/bike6.png', 'Xe đạp điện', 700000),
('bike7', 'IT2239', 'ITSS3428', 'QN8990', 'dock2', 1, 'assets/images/bike7.png', 'Xe đạp thường', 400000),
('bike8', 'IT2240', 'ITSS3429', 'NB7466', 'dock3', 1, 'assets/images/bike8.png', 'Xe đạp đôi', 550000),
('bike9', 'IT2241', 'ITSS3430', 'QB6600', 'dock3', 1, 'assets/images/bike9.png', 'Xe đạp điện', 700000);

-- 
-- Dumping data for table users
--
-- Table capstoneproject.users does not contain any data (it is empty)

-- 
-- Dumping data for table rentals
--
INSERT INTO rentals VALUES
('0e073d39-b1d0-11ed-8693-509a4cc45563', 'bike8', '17:10:18', '17:10:46', 0),
('141ed2b0-b2d7-11ed-99a5-509a4cc45563', 'bike2', '00:33:41', '00:33:46', 0),
('1ac40e0a-b2b2-11ed-8ee0-509a4cc45563', 'bike7', '20:08:56', '20:08:05', 0),
('3bc7f4ef-b2ae-11ed-8ee0-509a4cc45563', 'bike6', '19:40:02', '19:41:08', 13000),
('46d33780-b2b2-11ed-8ee0-509a4cc45563', 'bike6', '20:10:04', '20:10:23', 0),
('4840d371-b1e5-11ed-8693-509a4cc45563', 'bike9', '19:42:10', '19:42:39', 13000),
('48f1a8ab-b200-11ed-8693-509a4cc45563', 'bike2', '22:55:52', '22:55:10', 16000),
('7f16b9d9-b1e7-11ed-8693-509a4cc45563', 'bike6', '19:58:05', '19:58:39', 16000),
('a3d7133f-b1cb-11ed-8693-509a4cc45563', 'bike8', '16:38:58', '00:00:08', 0),
('a6f6c7cc-b1fe-11ed-8693-509a4cc45563', 'bike3', '22:44:15', '22:44:21', 13000),
('e55c775d-b2af-11ed-8ee0-509a4cc45563', 'bike7', '19:52:36', '19:52:17', 16000);

-- 
-- Dumping data for table cards
--
-- Table capstoneproject.cards does not contain any data (it is empty)

-- 
-- Dumping data for table twinbikes
--
INSERT INTO twinbikes VALUES
('bike2'),
('bike5'),
('bike8');

-- 
-- Dumping data for table transactions
--
-- Table capstoneproject.transactions does not contain any data (it is empty)

-- 
-- Dumping data for table standardebikes
--
INSERT INTO standardebikes VALUES
('bike3', 4, 80),
('bike6', 6, 66),
('bike9', 7, 85);

-- 
-- Dumping data for table standardbikes
--
INSERT INTO standardbikes VALUES
('bike1'),
('bike10'),
('bike4'),
('bike7');

--
-- Set default database
--
USE capstoneproject;

--
-- Drop trigger `before_insert_rental`
--
DROP TRIGGER IF EXISTS before_insert_rental;

--
-- Set default database
--
USE capstoneproject;

DELIMITER $$

--
-- Create trigger `before_insert_rental`
--
CREATE 
	DEFINER = 'root'@'localhost'
TRIGGER before_insert_rental
	BEFORE INSERT
	ON rentals
	FOR EACH ROW
SET new.rentalId = uuid()
$$

DELIMITER ;

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;